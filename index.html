<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>BurgisBurgersBros</title>
<link rel="stylesheet" href="styles.css">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>

<header>
<nav>
<h2>BurgisBurgersBros</h2>
<div>üí∞ Guthaben: <span id="balance">0</span> Fluffycoins</div>
<a href="status/index.html">Status</a>
</nav>
<div class="hero">
<h1>Bestellen nur zum Spa√ü üçî</h1>
</div>
</header>

<div class="products" id="products"></div>

<section id="cart">
<h3>Warenkorb</h3>
<ul id="cartItems"></ul>
<p><b>Gesamt:</b> <span id="total">0</span> FC</p>
<button id="orderBtn">Bestellen</button>
</section>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
 databaseURL:"https://mcking-659b6-default-rtdb.europe-west1.firebasedatabase.app"
});
const db = firebase.database();

/* ================= DOM ================= */
const productsDiv = document.getElementById("products");
const cartItemsEl = document.getElementById("cartItems");
const totalEl = document.getElementById("total");
const balanceEl = document.getElementById("balance");
const orderBtn = document.getElementById("orderBtn");

/* ================= WALLET ================= */
db.ref("wallet/balance").on("value", snap => {
 if (!snap.exists()) {
   db.ref("wallet").set({ balance: 500 });
   balanceEl.textContent = 500;
 } else {
   balanceEl.textContent = snap.val();
 }
});

/* ================= PRODUKTE (67+) ================= */
const productNames = [
"Cheeseburger","Hamburger","Bacon Burger","BBQ Burger","Chicken Burger",
"Fish Burger","Veggie Burger","Tower Burger","Mega Burger","Classic Burger",
"Vanilla Ice","Apple Pie","Brownie","Donut","Sundae","Milkshake",
"Cola","Fanta","Sprite","Water","Iced Tea","Coffee",
"Fries Small","Fries Medium","Fries Large","Curly Fries","Nuggets",
"Onion Rings","Mozzarella","Hash Browns","Side Salad","Wrap",
"Big Stack","Street Burger","Smoky Burger","Hot Burger","Urban Burger",
"Midnight Burger","Cheese Deluxe","Grill Burger","Crispy Burger",
"Cookie","Ice Cone","Churros","Cheese Sauce","Latte","Cappuccino",
"Hot Chocolate","Orange Juice","Apple Juice","Milk","Cola Zero",
"Nuggets 9","Nuggets 20","Fries XXL","Double Cheeseburger","Triple Burger",
"BBQ Wrap","Chicken Box","Family Box"
];

/* ================= WARENKORB ================= */
let cart = [];
let total = 0;

function renderCart() {
 cartItemsEl.innerHTML = "";
 cart.forEach(item => {
   const li = document.createElement("li");
   li.textContent = `${item.name} ‚Äì ${item.price} FC`;
   cartItemsEl.appendChild(li);
 });
 totalEl.textContent = total;
}

/* ================= PRODUKTE RENDERN ================= */
productNames.forEach(name => {
 const price = Math.floor(Math.random() * 21) + 5;
 const div = document.createElement("div");
 div.className = "product";
 div.innerHTML = `
   <h3>${name}</h3>
   <p class="price">${price} FC</p>
   <button>+</button>
 `;
 div.querySelector("button").addEventListener("click", () => {
   cart.push({ name, price });
   total += price;
   renderCart();
 });
 productsDiv.appendChild(div);
});

/* ================= BESTELLEN ================= */
orderBtn.addEventListener("click", () => {
 if (cart.length === 0) return alert("Warenkorb leer!");

 db.ref("wallet/balance").once("value", snap => {
   if (snap.val() < total) {
     alert("Nicht genug Fluffycoins!");
     return;
   }

   const orderNumber = Math.floor(100 + Math.random() * 900);

   db.ref("orders/" + orderNumber).set({
     items: cart,
     totalFC: total,
     status: "In Zubereitung",
     npc: false
   });

   db.ref("wallet/balance").set(snap.val() - total);

   cart = [];
   total = 0;
   renderCart();
 });
});

/* ================= NPC BESTELLUNGEN ================= */
setInterval(() => {
 const orderNumber = Math.floor(100 + Math.random() * 900);
 const count = Math.floor(Math.random() * 4) + 1;
 let items = [];
 let sum = 0;

 for (let i = 0; i < count; i++) {
   const name = productNames[Math.floor(Math.random() * productNames.length)];
   const price = Math.floor(Math.random() * 21) + 5;
   items.push({ name, price });
   sum += price;
 }

 db.ref("orders/" + orderNumber).set({
   items: items,
   totalFC: sum,
   status: "In Zubereitung",
   npc: true
 });
}, 45000);
</script>

</body>
</html>
