<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Status</title>
<link rel="stylesheet" href="../styles.css">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
#lockscreen{
  position:fixed;
  inset:0;
  background:#111;
  color:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:999999;
}
#lockscreen input{
  padding:10px;
  font-size:16px;
  margin-top:10px;
}
#lockscreen button{
  padding:10px 20px;
  margin-top:10px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ðŸ”’ LOCKSCREEN -->
<div id="lockscreen">
  <h2>ðŸ”’ GeschÃ¼tzter Bereich</h2>
  <input type="password" id="pwInput" placeholder="Passwort">
  <button id="loginBtn">Login</button>
  <p id="msg" style="color:red;"></p>
</div>

<!-- AUDIO ELEMENT FÃœR PING -->
<audio id="pingSound" src="../ping.mp3" preload="auto"></audio>

<h2 style="text-align:center">Bestellstatus</h2>

<table>
<tr>
<th>In Zubereitung</th>
<th>Abholbereit</th>
</tr>
<tr>
<td id="prep"></td>
<td id="ready"></td>
</tr>
</table>

<script>
// Verstecktes Passwort (Base64-kodiert: "changeme" -> "Y2hhbmdlbWU=")
const hiddenPw = "Y2hhbmdlbWU=";
const realPw = atob(hiddenPw);

// LOCKSCREEN
const lock = document.getElementById("lockscreen");
const msg = document.getElementById("msg");
document.body.style.overflow = "hidden";

document.getElementById("loginBtn").onclick = () => {
  const input = document.getElementById("pwInput").value;
  if (input === realPw) {
    lock.remove();
    document.body.style.overflow = "auto";
  } else {
    msg.innerText = "Falsches Passwort";
  }
};

firebase.initializeApp({
 databaseURL:"https://mcking-659b6-default-rtdb.europe-west1.firebasedatabase.app"
});
const db=firebase.database();

// Variable zum Verfolgen der Bestellanzahl
let previousOrderCount = 0;

db.ref("orders").on("value",snap=>{
 prep.innerHTML=""; ready.innerHTML="";
 let currentOrderCount = 0;
 snap.forEach(o=>{
  const d=o.val();
  const el=`<div>${o.key}</div>`;
  d.status==="Abholbereit"?ready.innerHTML+=el:prep.innerHTML+=el;
  currentOrderCount++;
 });

 // PrÃ¼fe, ob eine neue Bestellung hinzugekommen ist
 if (currentOrderCount > previousOrderCount) {
  const pingSound = document.getElementById("pingSound");
  pingSound.play().catch(e => console.log("Audio konnte nicht abgespielt werden:", e)); // Fallback fÃ¼r Browser-BeschrÃ¤nkungen
 }

 // Aktualisiere die vorherige Anzahl
 previousOrderCount = currentOrderCount;
});
</script>

</body>
</html>